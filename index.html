<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Simulateur - GÃ©othermie NIBE</title>
  <style>
    /* Base styles and colours */
    :root {
      /* Couleurs principales adaptÃ©esÂ : 
         - Le vert foncÃ© devient la couleur primaire pour les boutons, la progression et les surlignages.
         - La couleur secondaire reste le rouge NIBE.
         - L'accent est un vert plus clair pour les Ã©lÃ©ments mis en Ã©vidence.
      */
      --color-primary: #00695c;        /* Vert foncÃ© pour les Ã©lÃ©ments interactifs */
      --color-secondary: #b71c1c;      /* Rouge foncÃ© (logo NIBE et textes importants) */
      --color-accent: #2e7d32;        /* Vert moyen pour les accents */
      --color-background: #f4f9f7;
      --color-surface: #ffffff;
      --color-text: #263238;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Inter", sans-serif;
      background: var(--color-background);
      color: var(--color-text);
      overscroll-behavior: none;
    }

    h1 {
      margin: 0;
      padding: 1rem;
      /* Utiliser flexbox pour aligner le logo et le titre sur la mÃªme ligne */
      display: flex;
      align-items: center;
      /* Centrer le contenu du bandeau en mode normal */
      justify-content: center;
      /* Centrer le texte Ã  l'intÃ©rieur pour l'affichage mobile */
      text-align: center;
      /* Bandeau clair pour mettre en valeur le logo rougeÂ : fond blanc et texte rouge */
      background: var(--color-surface);
      color: var(--color-secondary);
      font-size: 1.3rem;
    }

    /* Ajuster l'alignement du texte dans le bandeau */
    h1 span {
      display: inline-block;
      vertical-align: middle;
      font-weight: 600;
    }

    /* Container for the application */
    .app-container {
      max-width: 480px;
      margin: 0 auto;
      padding-bottom: 80px; /* leave room for mobile safe area */
      position: relative;
    }

    /* Progress bar */
    .progress-bar-container {
      height: 6px;
      width: 100%;
      background: #e0e0e0;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 1rem;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: var(--color-primary);
      transition: width 0.4s ease;
    }

    /* Step containers */
    .step {
      display: none;
      animation: fadeIn 0.4s ease forwards;
    }

    .step.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    /* Form elements */
    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      margin-top: 0;
      color: var(--color-secondary);
    }

    label {
      display: block;
      font-size: 0.9rem;
      margin-bottom: 0.3rem;
      font-weight: 500;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 0.95rem;
      box-sizing: border-box;
      margin-bottom: 1rem;
    }

    input[type="checkbox"] {
      transform: scale(1.2);
      margin-right: 0.6rem;
    }

    .checkbox-group {
      margin-bottom: 1rem;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      background: var(--color-surface);
      padding: 0.6rem;
      margin-bottom: 0.4rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    /* Agrandit la zone de la case Ã  cocher pour faciliter lâ€™activation */
    .checkbox-item input[type="checkbox"] {
      width: 1.3rem;
      height: 1.3rem;
      margin-right: 0.8rem;
      accent-color: var(--color-primary);
    }

    .next-btn, .prev-btn {
      display: inline-block;
      padding: 0.8rem 1.2rem;
      margin-top: 1rem;
      border: none;
      border-radius: 25px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .next-btn {
      background: var(--color-primary);
      color: #fff;
    }

    .next-btn:hover {
      background: var(--color-accent);
    }

    .prev-btn {
      background: var(--color-secondary);
      color: #fff;
      margin-right: 1rem;
    }

    .prev-btn:hover {
      background: var(--color-primary);
    }

    /* Results tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
    }
    th, td {
      border-bottom: 1px solid #ddd;
      padding: 0.4rem 0.5rem;
      text-align: left;
      font-size: 0.9rem;
    }
    th {
      background: var(--color-primary);
      color: #fff;
      font-weight: 600;
    }

    .results-section {
      margin-top: 1rem;
    }

    .chart-container {
      width: 100%;
      height: 250px;
      margin-top: 1rem;
      position: relative;
      /* Supprimer l'arriÃ¨reâ€‘plan et les dÃ©corations pour rendre le graphique plus neutre */
      background: transparent;
      border-radius: 0;
      box-shadow: none;
    }

    .chart-bars {
      /* Conteneur des barresÂ : occupe 100Â % de la hauteur et aligne les barres en bas */
      position: relative;
      height: 100%;
      width: 100%;
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      padding: 0 1rem;
    }
    .chart-bar {
      flex: 1;
      margin: 0 0.3rem;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
    }
    .chart-bar .bar {
      width: 80%;
      border-radius: 4px 4px 0 0;
      background: var(--color-primary);
      transition: height 0.5s ease;
    /* Assure une hauteur minimale pour que les barres soient visibles mÃªme pour de petites valeurs */
    min-height: 4px;
    }
    .chart-bar .label {
      margin-top: 0.3rem;
      font-size: 0.75rem;
      /* Utiliser flexbox pour aligner le logo et le titre sur la gauche */
      display: flex;
      align-items: center;
      justify-content: flex-start;
    }

    .print-btn {
      width: 100%;
      padding: 0.8rem;
      background: var(--color-secondary);
      color: #fff;
      border: none;
      border-radius: 25px;
      margin-top: 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .print-btn:hover {
      background: var(--color-primary);
    }

    /* Logo image sizing (used both on screen and in print) */
    .logo-img {
      /* Redimensionner le logo pour le rendre plus visible et lâ€™aligner Ã  gauche */
      /* Logo de taille intermÃ©diaire pour l'affichage mobile */
      width: 70px;
      height: auto;
      margin-right: 8px;
      vertical-align: middle;
    }

    /* Ajout d'espacement entre les paragraphes dans les sections de rÃ©sultats pour amÃ©liorer la lisibilitÃ© */
    .results-section p {
      margin: 0.4rem 0;
    }

    /* Highlight styles for results */
    .highlight-prime {
      color: var(--color-accent);
      font-weight: 700;
      background: rgba(0, 191, 165, 0.15);
      padding: 2px 6px;
      border-radius: 4px;
      display: inline;
    }
    .highlight-plus {
      color: #2e7d32; /* vert pour positif */
      font-weight: 700;
      background: rgba(46, 125, 50, 0.15);
      padding: 2px 6px;
      border-radius: 4px;
      display: inline;
    }
    .highlight-minus {
      color: #c62828; /* rouge pour nÃ©gatif */
      font-weight: 700;
      background: rgba(198, 40, 40, 0.15);
      padding: 2px 6px;
      border-radius: 4px;
      display: inline;
    }

    /* Encadrement vert pour le reste Ã  charge */
    .highlight-charge {
      color: #2e7d32;
      font-weight: 700;
      background: rgba(46, 125, 50, 0.15);
      padding: 2px 6px;
      border-radius: 4px;
      /* Suppression de la bordure pour amÃ©liorer lâ€™alignement */
      display: inline;
    }

    /* Style pour mettre en Ã©vidence la valeur d'amortissement (en annÃ©es) */
    .highlight-amort {
      background: #ffe0b2;
      color: var(--color-secondary);
      font-weight: 700;
      padding: 0 0.2rem;
      border-radius: 4px;
    }

    /* Bar colours â€“ gÃ©othermie highlighted */
    .bar {
      width: 80%;
      border-radius: 4px 4px 0 0;
      transition: height 0.5s ease;
    }
    .bar-default {
      background: var(--color-primary);
    }
    .bar-geothermie {
      background: var(--color-accent);
    }

    /* Ensure bar colours take precedence within chart bars */
    .chart-bar .bar-default {
      background: var(--color-primary) !important;
    }
    .chart-bar .bar-geothermie {
      background: var(--color-accent) !important;
    }

    /*------------------------------------------*/
    /* Styles pour les graphiques horizontaux  */
    /*------------------------------------------*/
    /* Conteneur des barres horizontales (coÃ»ts et consommations) */
    .chart-bars-horizontal {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      padding: 0.5rem;
    }
    /* Ligne d'une barre horizontale */
    .chart-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    /* Ã‰tiquette Ã  gauche de la barre */
    .row-label {
      flex-basis: 30%;
      font-size: 0.8rem;
      font-weight: 500;
    }
    /* Bar horizontale avec fond clair */
    .row-bar {
      flex-grow: 1;
      height: 16px;
      background: #e0f7f4;
      border-radius: 8px;
      position: relative;
    }
    /* Remplissage de la barre en fonction de la valeur */
    .row-fill {
      height: 100%;
      border-radius: 6px;
    }
    /* Couleurs des barres */
    .row-fill-default {
      background: var(--color-primary);
    }
    .row-fill-geothermie {
      background: var(--color-accent);
    }

    /* Valeur numÃ©rique Ã  droite de la barre de consommation */
    .row-value {
      font-size: 0.8rem;
      min-width: 60px;
      text-align: right;
    }

    /*----------------------------------------*/
    /* Styles pour le graphique en colonnes  */
    /*----------------------------------------*/
    .vertical-chart {
      display: flex;
      justify-content: space-around;
      align-items: flex-end;
      height: 200px;
      width: 100%;
    }
    .vertical-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      margin: 0 0.3rem;
      /* Occuper toute la hauteur du graphique pour permettre aux barres dâ€™Ãªtre dimensionnÃ©es correctement */
      height: 100%;
    }
    .vertical-bar {
      width: 30px;
      border-radius: 4px 4px 0 0;
    }
    .vertical-value {
      font-size: 0.7rem;
      margin-bottom: 0.2rem;
    }
    .vertical-label {
      font-size: 0.7rem;
      text-align: center;
      margin-top: 0.3rem;
    }

    /* Griser les champs de saisie pour les coÃ»ts Ã©nergÃ©tiques afin de guider l'utilisateur */
    .energy-fields input {
      background: #f5f5f5;
    }

    /* Valeur numÃ©rique pour les graphiques en colonnes */
    .bar-value {
      font-size: 0.7rem;
      text-align: center;
      margin-bottom: 0.2rem;
    }

    /* Print styles for PDF generation */
    @media print {
      /* DÃ©finir le format de page et les marges gÃ©nÃ©rales */
      @page {
        /* Format A4 sans marges par dÃ©fautÂ : les marges seront gÃ©rÃ©es via le padding du body ciâ€‘dessous */
        size: A4;
        margin: 0;
      }
      /* Fond blanc pour le PDF et ajout de marges internesÂ : 1Â cm en haut et en bas, 2Â cm Ã  gauche et Ã  droite */
      body {
        background: #fff;
        /* Police plus petite pour tenir sur une page A4 sans retour Ã  la ligne inutile */
        font-size: 8px;
        /* Marges externes gÃ©rÃ©es via le paddingÂ : 2Â cm Ã  gauche et Ã  droite, 0.8Â cm en haut et en bas */
        padding: 8mm 20mm 8mm 20mm;
        /* Laisser de lâ€™espace en bas pour le pied de page (note), afin dâ€™Ã©viter un chevauchement avec le graphique */
        padding-bottom: 40mm;
        margin: 0;
      }
      /* Masquer les Ã©lÃ©ments de navigation et la barre de progression */
      .progress-bar-container, .prev-btn, .next-btn, .print-btn {
        display: none !important;
      }
      /* Afficher uniquement l'Ã©tapeÂ 7 pour l'impression */
      #step7 {
        display: block !important;
      }
      /* Masquer le titre dâ€™Ã©tape dans le rapport */
      #step7 .section-title {
        display: none !important;
      }
      /* Masquer la note intÃ©grÃ©e Ã  lâ€™interface lors de lâ€™impression */
      #disclaimer {
        display: none !important;
      }
      /* Afficher la note sÃ©parÃ©e pour lâ€™impressionÂ : placer le texte dans le flux normal avec un grand espacement au-dessus
         afin quâ€™il ne chevauche pas le graphique. La note est masquÃ©e en mode interactif et seulement visible en impression. */
      #pdfFooter {
        /* Afficher la note uniquement en impression et la positionner en pied de page 
           La note est retirÃ©e du flux normal pour Ãªtre ancrÃ©e en bas de la page. */
        display: block !important;
        position: fixed;
        left: 20mm;
        right: 20mm;
        bottom: 8mm;
        font-size: 0.35rem;
        line-height: 1.3;
      }
      /* Ajuster la largeur et lâ€™espacement du conteneur principal */
      .app-container {
        max-width: none;
        margin: 0;
        padding: 0;
      }
      /* Ajuster la hauteur et la marge du graphique pour lâ€™impression pour Ã©conomiser de la place */
      .chart-container {
        height: 140px;
        margin-top: 0.5rem;
        margin-bottom: 0;
      }
      /* Adapter la hauteur du graphique vertical Ã  celle du conteneur pour lâ€™impression */
      .vertical-chart {
        height: 120px;
      }
      /* RÃ©duire la taille de la note/disclaimer pour gagner de la place */
      #disclaimer {
        font-size: 0.35rem;
      }

      /* Imprimer les couleurs de fond et des SVG de maniÃ¨re fidÃ¨le */
      html, body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      /* Aligner le bandeau Ã  gauche en impression pour que le logo soit bien positionnÃ© */
      h1 {
        justify-content: flex-start !important;
        text-align: left !important;
      }
      /* Ajuster la taille des titres des sections */
      .results-section h3 {
        font-size: 1rem;
        margin-bottom: 0.3rem;
      }
      /* RÃ©duire la taille des cellules de tableau pour Ã©conomiser de lâ€™espace */
      .results-section table th, .results-section table td {
        padding: 0.2rem 0.3rem;
        font-size: 0.75rem;
      }

    /* Style pour le logo dans le bandeau du titre (impression) */
    .logo-img {
      /* Agrandir le logo et lâ€™aligner vers la gauche en impression */
      width: 90px;
      height: auto;
      margin-right: 12px;
      vertical-align: middle;
    }
    }
  </style>
</head>
<body>
  <!-- Ajout du logo NIBE et couleur rouge pour le bandeau du titre -->
  <h1>
    <img class="logo-img" src="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTIwIDI4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiIHN0eWxlPSJmaWxsLXJ1bGU6ZXZlbm9kZDtjbGlwLXJ1bGU6ZXZlbm9kZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6MiI+PHBhdGggZD0iTTI0Mi44OTggMzYuNzg5Yy00LjQ4MiAxNC41MjktMTAuOTU4IDE2Ljk1LTE3LjE1MSAxNi45NWgtNS41NDFWMjkuOTA4aDEuODNjMi41MjcgMCA3LjY5OS0uMTM3IDguNDMxIDguNjE1aDIuNzc4VjE3LjkzNWgtMi43NzhjLS43MzIgOC4yNjgtNS45ODYgOC4xNzUtOC41MTQgOC4xNzVoLTEuNzQ3VjIuNTgyaDQuOTcxYzguODggMCAxNC40MjIgNi41MjMgMTYuNzAzIDE1LjM1M2gyLjY1TDI0NC4xNjMuMzQxaC01NC42ODJ2Mi4yNDFoNi4wMzJ2NTEuMTZoLTYuMDMydjIuMjMyaDU1LjQxNmwuMzcxLTE5LjE4NWgtMi4zN3pNMTU3Ljg5MSA0NS4wOTJjMCAyLjI0OC0uMTYzIDcuNjU2LTYuMzU2IDcuNjU2aC0yLjc2OVYyOS4xODloMS45NTNjNC4wNzQgMCA3LjE3MiAxLjIwNiA3LjE3MiA3LjM4NXY4LjUxOHptLTkuMTI1LTQxLjUxaDEuODczYzQuMTU0IDAgNi4yNzMgMS43NjUgNi4yNzMgNS45NDF2OS4xNTZjMCAzLjYxNC0xLjQ2NyA2LjI2NC00LjY0NSA2LjI2NGgtMy41MDFWMy41ODJ6bTE5Ljk2MiAyNC42MDdjLTEuNzA5LS4xNi0zLjUwNC0uMzItNS4yMTQtLjR2LTEuNjA2YzcuOTg2LS4xNjIgMTguODI0LTIuNzMgMTguODI0LTEyLjUyMyAwLTEwLjI3NC0xMS42MjctMTMuMzAxLTIwLjAyLTEzLjMwMUwxMTcuNjc3LjM0NWwuMDA2IDIuMjM3aDYuMTQzdjUxLjE3MWgtNi4xNGwuMDA0IDIuMjI1IDM1Ljg2My4wMDZjMTEuMzI4IDAgMzAuMTcxIDEuMTAzIDMwLjE3MS0xNC43OTEgMC04LjUwNy03LjQxNi0xMi4yODEtMTQuOTk2LTEzLjAwNHpNNzIuNjY2IDIuNTgyaDYuMTkzdjUxLjE3aC02LjE5M3YyLjIyMmgzNy42NXYtMi4yMjFoLTYuMTk0VjIuNTgyaDYuMTk0Vi4zNDFoLTM3LjY1djIuMjQxek00Ni4zOTcgMi41MDloMS42M2MzLjAxNSAwIDUuMTk2LjYxMyA1LjE5NiAzLjkzdjIzLjIxOUwzMS40ODQuMzQxSC4wMzZ2Mi4wODhoMS43MDJjMi41MjcgMCAzLjQ0OCAxLjgxOSA0Ljk5NyAzLjgyNXYzOS44NTljMCAzLjY5My0uNjc3IDcuNjkxLTQuMTgxIDcuNjkxSDB2Mi4xN2gxOS4zMDV2LTIuMTdoLTIuNjA5Yy0zLjkxMSAwLTQuMjQzLTMuOTk4LTQuMjQzLTcuNjkxVjEzLjk5NGwzMC40MzkgNDEuOThoMTYuMTMxVjEyLjE5MWMwLTUuOTY4LS41Mi05LjY4MiAzLjcxNi05LjY4MmgyLjc0M1YuMzQxSDQ2LjM5N3YyLjE2OHoiIHN0eWxlPSJmaWxsOiNhODFhMWE7ZmlsbC1ydWxlOm5vbnplcm8iIHRyYW5zZm9ybT0idHJhbnNsYXRlKC4wNDcgLS4xNjcpIHNjYWxlKC40ODg4OCkiLz48L3N2Zz4=" alt="NIBE logo" />
    <span>Simulateur&nbsp;â€”&nbsp;GÃ©othermie&nbsp;NIBE</span>
  </h1>
  <div class="app-container">
    <!-- Progress bar -->
    <div class="progress-bar-container">
      <div id="progress" class="progress-bar" style="width: 0%;"></div>
    </div>

    <!-- Step 1: Conditions prÃ©alables et localisation -->
    <div id="step1" class="step active">
      <p class="section-title">Ã‰tape 1Â : Conditions prÃ©alables</p>
      <div class="checkbox-group">
        <div class="checkbox-item">
          <input type="checkbox" id="engagement" checked />
          <label for="engagement">
            Je confirme quâ€™il sâ€™agit de ma rÃ©sidence principale en maison individuelle, que les travaux consistent en un remplacement dâ€™une chaudiÃ¨re gaz/fioul par une pompe Ã  chaleur gÃ©othermiqueÂ NIBE, quâ€™ils seront rÃ©alisÃ©s par une entrepriseÂ RGE et que le dossier sera dÃ©posÃ© avant les travaux.
          </label>
        </div>
      </div>
      <label for="codePostal">Code&nbsp;postal</label>
      <input type="text" id="codePostal" placeholder="ExÂ :Â 35000" maxlength="5" />
      <div style="text-align:right;">
        <button class="next-btn" onclick="nextStep(1)">SuivantÂ â–¶</button>
      </div>
    </div>

    <!-- Step 2: Informations fiscales et surface -->
    <div id="step2" class="step">
      <p class="section-title">Ã‰tapeÂ 2Â : Informations fiscales et surface</p>
      <label for="revenu">Revenu fiscal de rÃ©fÃ©rence (â‚¬)</label>
      <input type="number" id="revenu" placeholder="ExÂ :Â 45000" min="0" />
      <label for="foyer">Nombre de personnes dans le foyer</label>
      <input type="number" id="foyer" placeholder="ExÂ :Â 3" min="1" />
      <label for="surface">Surface chauffÃ©e (mÂ²)</label>
      <input type="number" id="surface" placeholder="ExÂ :Â 100" min="1" />
      <div style="text-align:right;">
        <button class="prev-btn" onclick="prevStep(2)">â—€Â PrÃ©cÃ©dent</button>
        <button class="next-btn" onclick="nextStep(2)">SuivantÂ â–¶</button>
      </div>
    </div>

    <!-- Step 3: Type de PAC et usage -->
    <div id="step3" class="step">
      <p class="section-title">Ã‰tapeÂ 3Â : Type de pompe Ã  chaleur</p>
      <label for="typePac">Type de pompe Ã  chaleur</label>
      <select id="typePac">
        <option value="sol">Sol/Eau (gÃ©othermie)</option>
        <option value="eau">Eau/Eau (aquathermie)</option>
      </select>
      <label for="temperature">TempÃ©rature de fonctionnement</label>
      <select id="temperature">
        <option value="35">35Â Â°C</option>
        <!-- 55Â Â°C avec radiateurs (pluriel) -->
        <option value="55">55Â Â°C radiateurs</option>
        <!-- 55Â Â°C avec plancher chauffant + radiateurs (pluriel) -->
        <option value="55r">55Â Â°C plancher chauffant + radiateurs</option>
      </select>
      <label for="usage">Usage</label>
      <select id="usage">
        <option value="chauffage">Chauffage seul</option>
        <option value="ecs">Chauffage + Eau chaude sanitaire (ECS)</option>
      </select>
      <div style="text-align:right;">
        <button class="prev-btn" onclick="prevStep(3)">â—€Â PrÃ©cÃ©dent</button>
        <button class="next-btn" onclick="nextStep(3)">SuivantÂ â–¶</button>
      </div>
    </div>

    <!-- Step 4: Choix du modÃ¨le NIBE -->
    <div id="step4" class="step">
      <p class="section-title">Ã‰tapeÂ 4Â : SÃ©lection du modÃ¨leÂ NIBE</p>
      <label for="modele">ModÃ¨le NIBE</label>
      <select id="modele">
        <!-- Options remplies dynamiquement -->
      </select>
      <div style="text-align:right;">
        <button class="prev-btn" onclick="prevStep(4)">â—€Â PrÃ©cÃ©dent</button>
        <button class="next-btn" onclick="nextStep(4)">SuivantÂ â–¶</button>
      </div>
    </div>

    <!-- Step 5: CoÃ»ts d'installation -->
    <div id="step5" class="step">
      <p class="section-title">Ã‰tapeÂ 5Â : CoÃ»ts dâ€™installation</p>
      <label for="coutFourniture">CoÃ»t fourniture PAC (â‚¬ TTC)</label>
      <!-- Exemple par dÃ©fautÂ : 15â€¯000Â â‚¬ -->
      <input type="number" id="coutFourniture" placeholder="Ex&nbsp;:Â 15000" min="0" />
      <label for="coutMO">CoÃ»t main dâ€™Å“uvre (â‚¬ TTC)</label>
      <!-- Exemple par dÃ©fautÂ : 2â€¯000Â â‚¬ -->
      <input type="number" id="coutMO" placeholder="Ex&nbsp;:Â 2000" min="0" />
      <label for="coutForage">CoÃ»t forage gÃ©othermique (â‚¬ TTC)</label>
      <!-- Exemple par dÃ©fautÂ : 7â€¯000Â â‚¬ -->
      <input type="number" id="coutForage" placeholder="Ex&nbsp;:Â 7000" min="0" />
      <label for="coutChaudiere">CoÃ»t du remplacement dâ€™une chaudiÃ¨re Ã©quivalente (â‚¬ TTC)</label>
      <!-- Exemple par dÃ©fautÂ : 5â€¯000Â â‚¬ -->
      <input type="number" id="coutChaudiere" placeholder="Ex&nbsp;:Â 5000" min="0" />
      <div style="text-align:right;">
        <button class="prev-btn" onclick="prevStep(5)">â—€Â PrÃ©cÃ©dent</button>
        <button class="next-btn" onclick="nextStep(5)">SuivantÂ â–¶</button>
      </div>
    </div>

    <!-- Step 6: ParamÃ¨tres dâ€™amortissement -->
    <div id="step6" class="step">
      <p class="section-title">Ã‰tapeÂ 6Â : ParamÃ¨tres dâ€™amortissement</p>
      <label for="energieType">Ã‰nergie actuelle utilisÃ©e</label>
      <select id="energieType" onchange="updateEnergyFields()">
        <option value="fuel">Fioul</option>
        <option value="gaz">Gaz naturel</option>
        <option value="propane">Propane</option>
      </select>
      <div id="fuelFields" class="energy-fields">
        <label for="fuelLitres">Consommation annuelle (litres)</label>
        <input type="number" id="fuelLitres" placeholder="ExÂ :Â 2000" min="0" value="2000" />
        <label for="fuelPrix">Prix du fioul (â‚¬Â /Â litre)</label>
        <!-- Mettre 1,50Â â‚¬ par dÃ©faut pour le fioul et mettre le placeholder en consÃ©quence -->
        <input type="number" id="fuelPrix" placeholder="ExÂ :Â 1,50" min="0" step="0.01" value="1.50" />
        <label for="fuelElecPrix">Prix du kWh Ã©lectrique (â‚¬)</label>
        <input type="number" id="fuelElecPrix" placeholder="ExÂ :Â 0,20" min="0" step="0.01" value="0.20" />
      </div>
      <div id="gazFields" class="energy-fields" style="display:none;">
        <label for="gazKwh">Consommation annuelle (kWh)</label>
        <input type="number" id="gazKwh" placeholder="ExÂ :Â 20000" min="0" value="20000" />
        <label for="gazPrix">Prix du gaz (â‚¬Â /Â kWh)</label>
        <input type="number" id="gazPrix" placeholder="ExÂ :Â 0,1284" min="0" step="0.0001" value="0.1284" />
        <label for="gazAbonnement">Abonnement gaz (â‚¬Â /Â an)</label>
        <input type="number" id="gazAbonnement" placeholder="ExÂ :Â 250" min="0" value="250" />
        <label for="gazElecPrix">Prix du kWh Ã©lectrique (â‚¬)</label>
        <input type="number" id="gazElecPrix" placeholder="ExÂ :Â 0,20" min="0" step="0.01" value="0.20" />
      </div>
      <div id="propaneFields" class="energy-fields" style="display:none;">
        <label for="propaneTonnes">Consommation annuelle (tonnes)</label>
        <input type="number" id="propaneTonnes" placeholder="ExÂ :Â 1,2" min="0" step="0.01" value="1.2" />
        <label for="propanePrix">Prix du propane (â‚¬Â /Â tonne)</label>
        <input type="number" id="propanePrix" placeholder="ExÂ :Â 3353" min="0" value="3353.4" />
        <label for="propaneAbonnement">Abonnement cuve (â‚¬Â /Â an)</label>
        <input type="number" id="propaneAbonnement" placeholder="ExÂ :Â 250" min="0" value="250" />
        <label for="propaneElecPrix">Prix du kWh Ã©lectrique (â‚¬)</label>
        <input type="number" id="propaneElecPrix" placeholder="ExÂ :Â 0,20" min="0" step="0.01" value="0.20" />
      </div>
      <div style="text-align:right;">
        <button class="prev-btn" onclick="prevStep(6)">â—€Â PrÃ©cÃ©dent</button>
        <button class="next-btn" onclick="nextStep(6)">SuivantÂ â–¶</button>
      </div>
    </div>

    <!-- Step 7: RÃ©sultats et rapport -->
    <div id="step7" class="step">
      <p class="section-title">Ã‰tapeÂ 7Â : RÃ©sultats de simulation</p>
      <div id="resultFinance" class="results-section"></div>
      <div id="resultAmort" class="results-section" style="margin-top: 1.5rem;"></div>
      <!-- Graphique comparatif des consommations -->
      <div id="consumptionChart" class="chart-container"></div>
      <!-- Note et rÃ©serves (visible dans le rapport PDF) -->
      <div id="disclaimer" class="results-section" style="display:none; margin-top: 1rem; line-height:1.3;">
        <p><strong>NoteÂ :Â </strong>Cette simulation est fournie Ã  titre indicatif et nâ€™a pas de valeur contractuelle. Les montants calculÃ©s reposent sur les informations dÃ©clarÃ©es par lâ€™utilisateur et des hypothÃ¨ses de coÃ»ts et de performances. Les aides financiÃ¨res (prime CEE et MaPrimeRÃ©novâ€™) dÃ©pendent de la catÃ©gorie de revenu, de la zone climatique, des justificatifs fournis et des validations des organismes compÃ©tents (ANAH, dÃ©lÃ©gataire CEE).</p>
        <p>Le remplacement est Ã©tudiÃ© comme un monogeste (chaudiÃ¨re gaz/fioul vers pompe Ã  chaleur gÃ©othermique NIBE). Les tarifs Ã©nergÃ©tiques utilisÃ©s par dÃ©faut sontÂ : gaz naturelÂ 0,1284Â â‚¬/kWh, fioulÂ 1,16Â â‚¬/L, propaneÂ 0,243Â â‚¬/kWh, Ã©lectricitÃ©Â 0,20Â â‚¬/kWh. Ces valeurs peuvent varier et doivent Ãªtre confirmÃ©es lors du projet.</p>
        <p>Le dossier de demande de subvention doit Ãªtre dÃ©posÃ© avant le dÃ©but des travaux et lâ€™installation doit Ãªtre rÃ©alisÃ©e par une entreprise certifiÃ©e RGE.</p>
      </div>
      <button class="print-btn" onclick="window.print()">ðŸ“„Â Ã‰diter PDF</button>
      <div style="text-align:right;">
        <button class="prev-btn" onclick="prevStep(7)">â—€Â PrÃ©cÃ©dent</button>
      </div>
    </div>
  </div>

  <!-- Pied de page destinÃ© Ã  lâ€™impression. Il sera affichÃ© en bas de la page PDF et cachÃ© en mode interactif -->
  <div id="pdfFooter" style="display:none; line-height:1.3;">
    <p><strong>NoteÂ :Â </strong>Cette simulation est fournie Ã  titre indicatif et nâ€™a pas de valeur contractuelle. Les montants calculÃ©s reposent sur les informations dÃ©clarÃ©es par lâ€™utilisateur et des hypothÃ¨ses de coÃ»ts et de performances. Les aides financiÃ¨res (prime CEE et MaPrimeRÃ©novâ€™) dÃ©pendent de la catÃ©gorie de revenu, de la zone climatique, des justificatifs fournis et des validations des organismes compÃ©tents (ANAH, dÃ©lÃ©gataire CEE).</p>
    <p>Le remplacement est Ã©tudiÃ© comme un monogeste (chaudiÃ¨re gaz/fioul vers pompe Ã  chaleur gÃ©othermiqueÂ NIBE). Les tarifs Ã©nergÃ©tiques utilisÃ©s par dÃ©faut sontÂ : gaz naturelÂ 0,1284Â â‚¬/kWh, fioulÂ 1,16Â â‚¬/L, propaneÂ 0,243Â â‚¬/kWh, Ã©lectricitÃ©Â 0,20Â â‚¬/kWh. Ces valeurs peuvent varier et doivent Ãªtre confirmÃ©es lors du projet.</p>
    <p>Le dossier de demande de subvention doit Ãªtre dÃ©posÃ© avant le dÃ©but des travaux et lâ€™installation doit Ãªtre rÃ©alisÃ©e par une entreprise certifiÃ©eÂ RGE.</p>
  </div>

  <script>
    /**
     * DonnÃ©es des barÃ¨mes de revenus (MaPrimeRÃ©nov' 2025)
     */
    const revenusBarÃ¨me = {
      nonIDF: {
        tres: [17173, 25115, 30206, 35285, 40388],
        modeste: [22015, 32197, 38719, 45234, 51775],
        inter: [30844, 45340, 54592, 63844, 73098],
        supInc: { tres: 5094, modeste: 6525, inter: 9254 }
      },
      IDF: {
        tres: [23768, 34884, 41893, 48914, 55961],
        modeste: [28933, 42463, 51000, 59549, 68123],
        inter: [40404, 59394, 71060, 83637, 95758],
        supInc: { tres: 7038, modeste: 8568, inter: 12122 }
      }
    };

    /**
     * Liste des dÃ©partements par zone climatique.
     * Si un dÃ©partement ne figure ni dans H1 ni dans H3, on considÃ¨re quâ€™il est en H2.
     */
    const zoneH1 = [
      '01','02','03','05','08','10','14','15','19','21','23','25','27','28','38','39','42','43','45','51','52','54','55','57','58','59','60','61','62','63','67','68','69','70','71','73','74','75','76','77','78','80','87','88','89','90','91','92','93','94','95','975'
    ];
    const zoneH3 = [
      '06','11','13','20','2A','2B','30','34','66','83','971','972','973','974','976'
    ];

    /**
     * DÃ©finitions des modÃ¨les et de leur efficacitÃ© ETAS minimale par tempÃ©rature.
     * Pour chaque modÃ¨le on stocke lâ€™ETAS minimal (bornes infÃ©rieures des plages) pour 35 Â°C et 55 Â°C.
     */
    const modelesData = {
      sol: {
        'NIBE S1156-8': { etas35: 200, etas55: 140 },
        'NIBE S1156-13': { etas35: 200, etas55: 140 },
        'NIBE S1156-18': { etas35: 230, etas55: 140 },
        'NIBE S1256-8': { etas35: 200, etas55: 140 },
        'NIBE S1256-13': { etas35: 200, etas55: 140 },
        'NIBE S1256-18': { etas35: 230, etas55: 140 },
        'NIBE F1253-4': { etas35: 200, etas55: 140 },
        'NIBE F1253-6': { etas35: 200, etas55: 140 },
        'NIBE F1153-4': { etas35: 200, etas55: 140 },
        'NIBE F1153-6': { etas35: 200, etas55: 140 },
        'NIBE S1155-25': { etas35: 200, etas55: 140 },
        'NIBE F1345-24': { etas35: 170, etas55: 140 },
        'NIBE F1345-40': { etas35: 170, etas55: 140 },
        'NIBE F1345-30': { etas35: 170, etas55: 111 },
        'NIBE F1345-60': { etas35: 170, etas55: 111 },
        'NIBE F1355-28': { etas35: 170, etas55: 140 },
        'NIBE F1355-43': { etas35: 170, etas55: 140 }
      },
      eau: {
        'NIBE S1156-8': { etas35: 230, etas55: 200 },
        'NIBE S1156-13': { etas35: 230, etas55: 230 },
        'NIBE S1156-18': { etas35: 230, etas55: 200 },
        'NIBE S1256-8': { etas35: 230, etas55: 200 },
        'NIBE S1256-13': { etas35: 230, etas55: 230 },
        'NIBE S1256-18': { etas35: 230, etas55: 200 },
        'NIBE F1253-4': { etas35: 230, etas55: 200 },
        'NIBE F1253-6': { etas35: 230, etas55: 200 },
        'NIBE F1153-4': { etas35: 230, etas55: 200 },
        'NIBE F1153-6': { etas35: 230, etas55: 200 },
        'NIBE S1155-25': { etas35: 230, etas55: 170 },
        'NIBE F1345-24': { etas35: 200, etas55: 170 },
        'NIBE F1345-40': { etas35: 200, etas55: 170 },
        'NIBE F1345-30': { etas35: 200, etas55: 140 },
        'NIBE F1345-60': { etas35: 200, etas55: 140 },
        'NIBE F1355-28': { etas35: 230, etas55: 170 },
        'NIBE F1355-43': { etas35: 230, etas55: 170 }
      }
    };

    // Energies standard pour la prime CEE (kWh) selon le niveau dâ€™efficacitÃ©
    const ceeLevelsChauffage = [88800, 102300, 111400, 117900, 120900];
    const ceeLevelsChauffageECS = [108100, 124600, 135600, 143500, 147200];

    let currentStep = 1;
    const totalSteps = 7;
    const state = {};

    // Initialise lâ€™interface de sÃ©lection des modÃ¨les selon le type de PAC
    function initModeleOptions() {
      const modeleSelect = document.getElementById('modele');
      modeleSelect.innerHTML = '';
      const type = document.getElementById('typePac').value;
      const models = modelesData[type];
      for (const model in models) {
        const opt = document.createElement('option');
        opt.value = model;
        opt.textContent = model;
        modeleSelect.appendChild(opt);
      }
    }

    // Met Ã  jour la visibilitÃ© des champs selon lâ€™Ã©nergie sÃ©lectionnÃ©e
    function updateEnergyFields() {
      const type = document.getElementById('energieType').value;
      document.getElementById('fuelFields').style.display = 'none';
      document.getElementById('gazFields').style.display = 'none';
      document.getElementById('propaneFields').style.display = 'none';
      if (type === 'fuel') {
        document.getElementById('fuelFields').style.display = 'block';
      } else if (type === 'gaz') {
        document.getElementById('gazFields').style.display = 'block';
      } else if (type === 'propane') {
        document.getElementById('propaneFields').style.display = 'block';
      }
    }

    // Determine la catÃ©gorie de revenu (trÃ¨s modeste, modeste, intermÃ©diaire, supÃ©rieur)
    function determineCategorie(revenu, foyers, isIDF) {
      const bar = revenusBarÃ¨me[isIDF ? 'IDF' : 'nonIDF'];
      const idx = Math.min(foyers, 5) - 1; // position dans tableau (0-4)
      // Calcule les seuils en fonction des personnes supplÃ©mentaires
      function seuil(baseArr, incVal) {
        if (foyers <= 5) {
          return baseArr[idx];
        }
        const base = baseArr[4];
        const extra = foyers - 5;
        return base + extra * incVal;
      }
      const tRes = seuil(bar.tres, bar.supInc.tres);
      const mRes = seuil(bar.modeste, bar.supInc.modeste);
      const iRes = seuil(bar.inter, bar.supInc.inter);
      if (revenu <= tRes) return 'tres-modeste';
      if (revenu <= mRes) return 'modeste';
      if (revenu <= iRes) return 'intermediaire';
      return 'superieur';
    }

    // Determine la zone climatique
    function determineZone(codePostal) {
      let dep = codePostal.substring(0, 2);
      // gestion Corse 2A/2B
      if (codePostal.startsWith('2A') || codePostal.startsWith('2B')) {
        dep = codePostal.substring(0, 2);
      }
      if (zoneH1.includes(dep)) return 'H1';
      if (zoneH3.includes(dep)) return 'H3';
      return 'H2';
    }

    // DÃ©termine lâ€™indice dâ€™efficacitÃ© Ã  partir de lâ€™ETAS minimal
    function getEfficiencyLevel(etas) {
      if (etas >= 230) return 4;
      if (etas >= 200) return 3;
      if (etas >= 170) return 2;
      if (etas >= 140) return 1;
      if (etas >= 111) return 0;
      return 0;
    }

    // Facteur correctif en fonction de la surface chauffÃ©e
    function getSurfaceFactor(area) {
      const a = parseFloat(area);
      if (a < 70) return 0.5;
      if (a < 90) return 0.7;
      if (a < 110) return 1;
      if (a < 130) return 1.1;
      return 1.6;
    }

    // Coefficient de zone
    function getZoneCoefficient(zone) {
      if (zone === 'H1') return 1.2;
      if (zone === 'H3') return 0.7;
      return 1;
    }

    // Calcule la prime CEE et MaPrimeRenov
    function calculAides() {
      // rÃ©cupÃ©ration des informations stockÃ©es dans lâ€™Ã©tat
      const type = state.typePac;
      const mode = state.modele;
      const temp = state.temperature;
      const usage = state.usage;
      const surface = parseFloat(state.surface);
      const revenu = parseFloat(state.revenu);
      const foyers = parseInt(state.foyer);
      const isIDF = state.isIDF;
      const zone = state.zoneClim;
      // efficacitÃ© ETAS minimal pour le modÃ¨le choisi
      const etasData = modelesData[type][mode];
      let etas;
      if (temp.startsWith('35')) {
        etas = etasData.etas35;
      } else {
        etas = etasData.etas55;
      }
      const level = getEfficiencyLevel(etas);
      // base kWh en fonction de lâ€™usage
      let baseKwh = (usage === 'ecs') ? ceeLevelsChauffageECS[level] : ceeLevelsChauffage[level];
      // on multiplie par surface factor et zone coefficient et bonification x5
      const surfFactor = getSurfaceFactor(surface);
      const zoneCoef = getZoneCoefficient(zone);
      const kwhCumac = baseKwh * surfFactor * zoneCoef * 5;
      const mwhCumac = kwhCumac / 1000;
      // catÃ©gorie de revenu
      const categorie = determineCategorie(revenu, foyers, isIDF);
      // barÃ¨me financier exprimÃ© en euros par MWh cumac
      // Les montants officiels sont dâ€™environ 8,26Â â‚¬/MWh pour les revenus trÃ¨s modestes (prÃ©caires)
      // et de 7,02Â â‚¬/MWh pour les revenus modestes et intermÃ©diaires. Les revenus supÃ©rieurs ne sont pas Ã©ligibles.
      let tarifMwh;
      if (categorie === 'tres-modeste') {
        tarifMwh = 8.26; // 8,26Â â‚¬/MWh cumac
      } else if (categorie === 'modeste' || categorie === 'intermediaire') {
        tarifMwh = 7.02; // 7,02Â â‚¬/MWh cumac
      } else {
        tarifMwh = 0; // revenus supÃ©rieurs : non Ã©ligible
      }
      const primeCEE = mwhCumac * tarifMwh;
      // MaPrimeRenov
      let primeMPR;
      if (categorie === 'tres-modeste') primeMPR = 11000;
      else if (categorie === 'modeste') primeMPR = 9000;
      else if (categorie === 'intermediaire') primeMPR = 6000;
      else primeMPR = 0;
      return { categorie, primeCEE, primeMPR, mwhCumac, kwhCumac };
    }

    // Calcule les coÃ»ts et reste Ã  charge
    function calculFinance() {
      const aides = calculAides();
      const coutFourniture = parseFloat(state.coutFourniture);
      const coutMO = parseFloat(state.coutMO);
      const coutForage = parseFloat(state.coutForage);
      const invest = coutFourniture + coutMO + coutForage;
      const primeTot = aides.primeCEE + aides.primeMPR;
      const resteCharge = invest - primeTot;
      const coutChaudiere = parseFloat(state.coutChaudiere);
      const plusValue = resteCharge - coutChaudiere;
      return { invest, primeCEE: aides.primeCEE, primeMPR: aides.primeMPR, primeTot, resteCharge, plusValue, categorie: aides.categorie, mwhCumac: aides.mwhCumac };
    }

    // Calcule lâ€™amortissement en fonction de lâ€™Ã©nergie choisie
    function calculAmortissement() {
      const type = state.energieType;
      let thermalEnergy; // en kWh thermique annuel
      let coutEnergy;
      let costDetails = {};
      const defaultFuelPrice = 1.16;
      const defaultGazPrice = 0.1284;
      const defaultGazAbonnement = 250;
      const defaultPropanePrice = 3353.4; // prix par tonne calculÃ© pour 0,243Â â‚¬/kWh
      const defaultPropaneAbonnement = 250;
      const defaultElecPrice = 0.20;
      // DÃ©termine le COP (Coefficient de performance) pour la gÃ©othermie selon la tempÃ©rature de fonctionnement.
      // Si la tempÃ©rature sÃ©lectionnÃ©e commence par "35", on utilise un COP de 6,5 (35Â Â°C). Sinon, un COP de 5 (55Â Â°C ou 55r).
      let cop = 5;
      if (state.temperature && state.temperature.startsWith('35')) {
        cop = 6.5;
      }
      if (type === 'fuel') {
        const litres = parseFloat(state.fuelLitres);
        const prixLitre = parseFloat(state.fuelPrix);
        const prixElec = parseFloat(state.fuelElecPrix);
        thermalEnergy = litres * 10;
        coutEnergy = litres * prixLitre;
        costDetails.fuel = { consommation: litres, cout: coutEnergy, unit: 'L', prixUnit: prixLitre };
        // gaz avec valeurs par dÃ©faut
        const gazCons = thermalEnergy; // 1 kWh thermique = 1 kWh gaz naturel
        const gazCost = gazCons * defaultGazPrice + defaultGazAbonnement;
        costDetails.gaz = { consommation: gazCons, cout: gazCost, unit: 'kWh', prixUnit: defaultGazPrice, abonnement: defaultGazAbonnement };
        // propane avec valeurs par dÃ©faut
        const propaneConsTon = thermalEnergy / (13.8 * 1000);
        const propaneCost = propaneConsTon * defaultPropanePrice + defaultPropaneAbonnement;
        costDetails.propane = { consommation: propaneConsTon, cout: propaneCost, unit: 't', prixUnit: defaultPropanePrice, abonnement: defaultPropaneAbonnement };
        // gÃ©othermie
        const geothKwh = thermalEnergy / cop;
        const geothCost = geothKwh * prixElec;
        costDetails.geothermie = { consommation: geothKwh, cout: geothCost, unit: 'kWh', prixUnit: prixElec };
      } else if (type === 'gaz') {
        const kwhGaz = parseFloat(state.gazKwh);
        const prixGaz = parseFloat(state.gazPrix);
        const aboGaz = parseFloat(state.gazAbonnement);
        const prixElec = parseFloat(state.gazElecPrix);
        thermalEnergy = kwhGaz; // 1 kWh gaz = 1 kWh thermique
        coutEnergy = kwhGaz * prixGaz + aboGaz;
        costDetails.gaz = { consommation: kwhGaz, cout: coutEnergy, unit: 'kWh', prixUnit: prixGaz, abonnement: aboGaz };
        // fuel default
        const fuelLitres = thermalEnergy / 10;
        const fuelCost = fuelLitres * defaultFuelPrice;
        costDetails.fuel = { consommation: fuelLitres, cout: fuelCost, unit: 'L', prixUnit: defaultFuelPrice };
        // propane default
        const propaneConsTon = thermalEnergy / (13.8 * 1000);
        const propaneCost = propaneConsTon * defaultPropanePrice + defaultPropaneAbonnement;
        costDetails.propane = { consommation: propaneConsTon, cout: propaneCost, unit: 't', prixUnit: defaultPropanePrice, abonnement: defaultPropaneAbonnement };
        // gÃ©othermie
        const geothKwh = thermalEnergy / cop;
        const geothCost = geothKwh * prixElec;
        costDetails.geothermie = { consommation: geothKwh, cout: geothCost, unit: 'kWh', prixUnit: prixElec };
      } else if (type === 'propane') {
        const tonnes = parseFloat(state.propaneTonnes);
        const prixT = parseFloat(state.propanePrix);
        const aboP = parseFloat(state.propaneAbonnement);
        const prixElec = parseFloat(state.propaneElecPrix);
        thermalEnergy = tonnes * 1000 * 13.8;
        coutEnergy = tonnes * prixT + aboP;
        costDetails.propane = { consommation: tonnes, cout: coutEnergy, unit: 't', prixUnit: prixT, abonnement: aboP };
        // fuel default
        const fuelLitres = thermalEnergy / 10;
        const fuelCost = fuelLitres * defaultFuelPrice;
        costDetails.fuel = { consommation: fuelLitres, cout: fuelCost, unit: 'L', prixUnit: defaultFuelPrice };
        // gaz default
        const gazCons = thermalEnergy;
        const gazCost = gazCons * defaultGazPrice + defaultGazAbonnement;
        costDetails.gaz = { consommation: gazCons, cout: gazCost, unit: 'kWh', prixUnit: defaultGazPrice, abonnement: defaultGazAbonnement };
        // gÃ©othermie
        const geothKwh = thermalEnergy / cop;
        const geothCost = geothKwh * prixElec;
        costDetails.geothermie = { consommation: geothKwh, cout: geothCost, unit: 'kWh', prixUnit: prixElec };
      }
      // calcul des Ã©missions de CO2
      const emissionFactors = { fuel: 0.314, gaz: 0.243, propane: 0.27, electric: 0.053 };
      let emissionsOld = 0;
      let emissionsGeo = 0;
      let emissionsSaved = 0;
      if (type === 'fuel' || type === 'gaz' || type === 'propane') {
        // Ã©missions du systÃ¨me actuel (kWh thermique * facteur)
        emissionsOld = thermalEnergy * emissionFactors[type];
        // gÃ©othermie utilise la consommation Ã©lectrique correspondante
        const geothKwh = costDetails.geothermie ? costDetails.geothermie.consommation : thermalEnergy / cop;
        emissionsGeo = geothKwh * emissionFactors.electric;
        emissionsSaved = emissionsOld - emissionsGeo;
      }
      return { thermalEnergy, coutEnergy, costDetails, emissionsOld, emissionsGeo, emissionsSaved };
    }

    // Met Ã  jour la progression
    function updateProgress() {
      const percent = (currentStep - 1) / (totalSteps - 1) * 100;
      document.getElementById('progress').style.width = percent + '%';
    }

    // Passe Ã  lâ€™Ã©tape suivante aprÃ¨s validation
    function nextStep(step) {
      if (!validateStep(step)) return;
      document.getElementById(`step${step}`).classList.remove('active');
      currentStep = Math.min(totalSteps, step + 1);
      document.getElementById(`step${currentStep}`).classList.add('active');
      updateProgress();
      // actions spÃ©cifiques lors de certaines transitions
      if (currentStep === 4) {
        // Lors de l'arrivÃ©e sur le choix du modÃ¨le, on rafraÃ®chit la liste des modÃ¨les
        initModeleOptions();
      }
      if (currentStep === 7) {
        // Lorsque l'on affiche les rÃ©sultats finaux
        afficherResultats();
      }
    }

    function prevStep(step) {
      document.getElementById(`step${step}`).classList.remove('active');
      currentStep = Math.max(1, step - 1);
      document.getElementById(`step${currentStep}`).classList.add('active');
      updateProgress();
    }

    // Validation par Ã©tape et enregistrement de lâ€™Ã©tat
    function validateStep(step) {
      if (step === 1) {
        // VÃ©rification du consentement et du code postal
        if (!document.getElementById('engagement').checked) {
          alert('Veuillez confirmer que vous remplissez les conditions prÃ©alables.');
          return false;
        }
        const code = document.getElementById('codePostal').value.trim();
        if (!code || code.length < 2) {
          alert('Veuillez saisir un code postal valide.');
          return false;
        }
        // dÃ©terminer IDF et zone climatique
        const dep = code.substring(0, 2);
        const idfDeps = ['75','77','78','91','92','93','94','95'];
        const isIDF = idfDeps.includes(dep);
        const zone = determineZone(code);
        state.codePostal = code;
        state.isIDF = isIDF;
        state.zoneClim = zone;
      } else if (step === 2) {
        // Saisie du revenu, nombre de personnes et surface
        const revenuVal = parseFloat(document.getElementById('revenu').value);
        const foyersVal = parseInt(document.getElementById('foyer').value);
        const surfaceVal = parseFloat(document.getElementById('surface').value);
        if (isNaN(revenuVal) || isNaN(foyersVal) || isNaN(surfaceVal)) {
          alert('Veuillez saisir le revenu fiscal, le nombre de personnes et la surface chauffÃ©e.');
          return false;
        }
        state.revenu = revenuVal;
        state.foyer = foyersVal;
        state.surface = surfaceVal;
      } else if (step === 3) {
        // Type de PAC, tempÃ©rature et usage
        const type = document.getElementById('typePac').value;
        const temp = document.getElementById('temperature').value;
        const usage = document.getElementById('usage').value;
        state.typePac = type;
        state.temperature = temp;
        state.usage = usage;
      } else if (step === 4) {
        // Choix du modÃ¨le
        const modele = document.getElementById('modele').value;
        state.modele = modele;
      } else if (step === 5) {
        // CoÃ»ts d'installation (autoriser des champs vides => 0)
        let coutFourniture = parseFloat(document.getElementById('coutFourniture').value);
        let coutMO = parseFloat(document.getElementById('coutMO').value);
        let coutForage = parseFloat(document.getElementById('coutForage').value);
        let coutChaudiere = parseFloat(document.getElementById('coutChaudiere').value);
        coutFourniture = isNaN(coutFourniture) ? 0 : coutFourniture;
        coutMO = isNaN(coutMO) ? 0 : coutMO;
        coutForage = isNaN(coutForage) ? 0 : coutForage;
        coutChaudiere = isNaN(coutChaudiere) ? 0 : coutChaudiere;
        state.coutFourniture = coutFourniture;
        state.coutMO = coutMO;
        state.coutForage = coutForage;
        state.coutChaudiere = coutChaudiere;
      } else if (step === 6) {
        // ParamÃ¨tres dâ€™amortissement (utiliser valeurs par dÃ©faut si champs vides)
        const type = document.getElementById('energieType').value;
        state.energieType = type;
        if (type === 'fuel') {
          // Remplace les virgules Ã©ventuelles par des points avant d'analyser
          let litres = parseFloat(document.getElementById('fuelLitres').value.replace(',', '.'));
          let prix = parseFloat(document.getElementById('fuelPrix').value.replace(',', '.'));
          let prixElec = parseFloat(document.getElementById('fuelElecPrix').value.replace(',', '.'));
          // valeurs par dÃ©faut si vide
          litres = isNaN(litres) ? 2000 : litres;
          prix = isNaN(prix) ? 1.16 : prix;
          prixElec = isNaN(prixElec) ? 0.20 : prixElec;
          state.fuelLitres = litres;
          state.fuelPrix = prix;
          state.fuelElecPrix = prixElec;
        } else if (type === 'gaz') {
          let kwh = parseFloat(document.getElementById('gazKwh').value.replace(',', '.'));
          let prix = parseFloat(document.getElementById('gazPrix').value.replace(',', '.'));
          let abo = parseFloat(document.getElementById('gazAbonnement').value.replace(',', '.'));
          let prixElec = parseFloat(document.getElementById('gazElecPrix').value.replace(',', '.'));
          kwh = isNaN(kwh) ? 20000 : kwh;
          prix = isNaN(prix) ? 0.1284 : prix;
          abo = isNaN(abo) ? 250 : abo;
          prixElec = isNaN(prixElec) ? 0.20 : prixElec;
          state.gazKwh = kwh;
          state.gazPrix = prix;
          state.gazAbonnement = abo;
          state.gazElecPrix = prixElec;
        } else if (type === 'propane') {
          let tonnes = parseFloat(document.getElementById('propaneTonnes').value.replace(',', '.'));
          let prixT = parseFloat(document.getElementById('propanePrix').value.replace(',', '.'));
          let abo = parseFloat(document.getElementById('propaneAbonnement').value.replace(',', '.'));
          let prixElec = parseFloat(document.getElementById('propaneElecPrix').value.replace(',', '.'));
          tonnes = isNaN(tonnes) ? 1.2 : tonnes;
          prixT = isNaN(prixT) ? 3353.4 : prixT;
          abo = isNaN(abo) ? 250 : abo;
          prixElec = isNaN(prixElec) ? 0.20 : prixElec;
          state.propaneTonnes = tonnes;
          state.propanePrix = prixT;
          state.propaneAbonnement = abo;
          state.propaneElecPrix = prixElec;
        }
      }
      return true;
    }

    // Affiche les rÃ©sultats financiers et dâ€™amortissement
    function afficherResultats() {
      const finance = calculFinance();
      const amort = calculAmortissement();
      // RÃ©sumÃ© financier
      const finDiv = document.getElementById('resultFinance');
      finDiv.innerHTML = '';
      let html = '<h3>RÃ©sultats de simulation</h3>';
      html += '<table><tr><th>Ã‰lÃ©ment</th><th>Montant (â‚¬)</th></tr>';
      // DÃ©taille chaque composant de lâ€™investissement
      html += `<tr><td>CoÃ»t fourniture PAC</td><td>${state.coutFourniture.toFixed(2)}</td></tr>`;
      html += `<tr><td>CoÃ»t main dâ€™Å“uvre</td><td>${state.coutMO.toFixed(2)}</td></tr>`;
      html += `<tr><td>CoÃ»t forage</td><td>${state.coutForage.toFixed(2)}</td></tr>`;
      html += `<tr><td>Investissement total</td><td>${finance.invest.toFixed(2)}</td></tr>`;
      // Affiche les primes sans mise en valeur individuelle
      html += `<tr><td>PrimeÂ CEE</td><td>${finance.primeCEE.toFixed(2)}</td></tr>`;
      html += `<tr><td>MaPrimeRÃ©novâ€™</td><td>${finance.primeMPR.toFixed(2)}</td></tr>`;
      // Mise en valeur du total des primes
      // Mise en valeur du total des primes avec un span pour prÃ©server lâ€™alignement
      html += `<tr><td>Total des primes</td><td><span class="highlight-prime">${finance.primeTot.toFixed(2)}</span></td></tr>`;
      // Mise en valeur du reste Ã  charge avec un encadrement vert
      html += `<tr><td>Reste Ã  charge</td><td><span class="highlight-charge">${finance.resteCharge.toFixed(2)}</span></td></tr>`;
      html += `<tr><td>CoÃ»t remplacement chaudiÃ¨re Ã©quivalente</td><td>${state.coutChaudiere.toFixed(2)}</td></tr>`;
      const pvClass = finance.plusValue >= 0 ? 'highlight-plus' : 'highlight-minus';
      html += `<tr><td>DiffÃ©rence (gÃ©othermieÂ â€“Â remplacement)</td><td><span class="${pvClass}">${finance.plusValue.toFixed(2)}</span></td></tr>`;
      html += '</table>';
      // Informations complÃ©mentaires : catÃ©gorie, zones et Ã©nergie cumulÃ©e
      html += `<p>CatÃ©gorie de revenuÂ : <strong>${finance.categorie}</strong></p>`;
      // Ajoute la zone gÃ©ographique (ÃŽleâ€‘deâ€‘France ou hors IDF)
      const zoneGeo = state.isIDF ? 'ÃŽleâ€‘deâ€‘France' : 'HorsÂ ÃŽleâ€‘deâ€‘France';
      html += `<p>Zone gÃ©ographiqueÂ : <strong>${zoneGeo}</strong></p>`;
      html += `<p>Zone climatiqueÂ : <strong>${state.zoneClim}</strong> (facteur zone ${getZoneCoefficient(state.zoneClim)})</p>`;
      html += `<p>Surface chauffÃ©eÂ : <strong>${state.surface}Â mÂ²</strong> (facteur surface ${getSurfaceFactor(state.surface)})</p>`;
      const kwhCumac = finance.mwhCumac * 1000;
      html += `<p>Ã‰nergie cumulÃ©e CEEÂ : <strong>${kwhCumac.toFixed(0)}</strong>Â kWh cumac (${finance.mwhCumac.toFixed(2)}Â MWh)</p>`;
      finDiv.innerHTML = html;
      // RÃ©sumÃ© amortissement
      const amortDiv = document.getElementById('resultAmort');
      amortDiv.innerHTML = '';
      let h = '<h3>Amortissement et consommation</h3>';
      // Tableau des coÃ»ts comparÃ©s
      h += '<table><tr><th>Ã‰nergie</th><th>Consommation</th><th>CoÃ»t annuel (â‚¬)</th></tr>';
      const c = amort.costDetails;
      // Format consumption with units
      function formatCons(val, unit) {
        // Toutes les consommations en kilowattheure sont affichÃ©es avec lâ€™unitÃ© Â«Â kWhÂ Â», mÃªme pour la gÃ©othermie
        if (unit === 'kWh' || unit === 'kWhÃ©lec' || unit === 'kWhe') {
          return val.toFixed(0) + ' kWh';
        }
        return val.toFixed(2) + ' ' + unit;
      }
      // Afficher uniquement lâ€™Ã©nergie sÃ©lectionnÃ©e et la gÃ©othermie
      const selected = state.energieType;
      if (selected === 'fuel' && c.fuel) {
        h += `<tr><td>Fioul</td><td>${formatCons(c.fuel.consommation, c.fuel.unit)}</td><td>${c.fuel.cout.toFixed(2)}</td></tr>`;
      }
      if (selected === 'gaz' && c.gaz) {
        h += `<tr><td>Gaz naturel</td><td>${formatCons(c.gaz.consommation, c.gaz.unit)}</td><td>${c.gaz.cout.toFixed(2)}</td></tr>`;
      }
      if (selected === 'propane' && c.propane) {
        h += `<tr><td>Propane</td><td>${formatCons(c.propane.consommation, c.propane.unit)}</td><td>${c.propane.cout.toFixed(2)}</td></tr>`;
      }
      // Toujours afficher la gÃ©othermie
      if (c.geothermie) {
        // Afficher simplement "GÃ©othermie" (sans mention de la consommation Ã©lectrique) pour plus de clartÃ©
        h += `<tr><td>GÃ©othermie</td><td>${formatCons(c.geothermie.consommation, c.geothermie.unit)}</td><td>${c.geothermie.cout.toFixed(2)}</td></tr>`;
      }
      h += '</table>';
      // Calcul Ã©conomie annuelle et amortissement
      const coutActuel = amort.coutEnergy;
      const coutGeo = c.geothermie ? c.geothermie.cout : 0;
      const economie = coutActuel - coutGeo;
      const plusVal = finance.plusValue;
      let amorti = 'âˆž';
      if (economie > 0) {
        amorti = (plusVal / economie).toFixed(1);
      }
      h += `<p>CoÃ»t annuel actuelÂ : <strong>${coutActuel.toFixed(2)}</strong>Â â‚¬</p>`;
      h += `<p>CoÃ»t annuel avec gÃ©othermieÂ : <strong>${coutGeo.toFixed(2)}</strong>Â â‚¬</p>`;
      h += `<p>Ã‰conomie annuelle estimÃ©eÂ : <strong>${economie.toFixed(2)}</strong>Â â‚¬</p>`;
      h += `<p>Amortissement estimÃ© (annÃ©es)Â : <span class="highlight-amort">${amorti}</span></p>`;
      // Ã‰missions Ã©vitÃ©es
      if (amort.emissionsSaved && amort.emissionsSaved > 0) {
        h += `<p>Ã‰missions Ã©vitÃ©esÂ : <strong>${amort.emissionsSaved.toFixed(0)}</strong>Â kgÂ COâ‚‚/an</p>`;
      }
      amortDiv.innerHTML = h;
      // Graphique de comparaison des coÃ»ts annuels (â‚¬/an)
      // On prÃ©pare les coÃ»ts par Ã©nergie pour lâ€™histogrammeÂ : gÃ©othermie en premier, puis fioul, gaz naturel et propane
      const barLabels = [];
      const barValues = [];
      if (c.geothermie) {
        barLabels.push('GÃ©othermie');
        barValues.push(c.geothermie.cout);
      }
      // Ajout du fioul (coÃ»t annuel de rÃ©fÃ©rence) : s'il n'existe pas, on met zÃ©ro pour ne pas fausser le graphique
      barLabels.push('Fioul');
      barValues.push(c.fuel ? c.fuel.cout : 0);
      // Ajout du gaz naturel
      barLabels.push('Gaz naturel');
      barValues.push(c.gaz ? c.gaz.cout : 0);
      // Ajout du propane
      barLabels.push('Propane');
      barValues.push(c.propane ? c.propane.cout : 0);
      // Dessine un graphique Ã  barres verticales avec un Ã©lÃ©ment SVG afin que les couleurs soient conservÃ©es Ã  l'impression
      drawSVGColumnChart('consumptionChart', barLabels, barValues);
    }

    // DÃ©finition d'un graphique horizontal (barres) utilisÃ© pour les coÃ»ts et les consommations.
    // Ce graphique crÃ©e une liste de barres horizontales oÃ¹ la gÃ©othermie est mise en Ã©vidence par une couleur diffÃ©rente.
    function drawBarGraph(containerId, labels, values) {
      const container = document.getElementById(containerId);
      if (!container) return;
      // Nettoie le conteneur
      container.innerHTML = '';
      // Calcul de la valeur maximale pour normaliser la largeur
      const maxVal = Math.max(...values);
      // CrÃ©ation du wrapper pour l'ensemble des lignes
      const wrapper = document.createElement('div');
      wrapper.className = 'chart-bars-horizontal';
      labels.forEach((label, idx) => {
        // CrÃ©ation de la ligne de graphique
        const row = document.createElement('div');
        row.className = 'chart-row';
        // Ã‰tiquette Ã  gauche
        const lbl = document.createElement('div');
        lbl.className = 'row-label';
        lbl.textContent = label;
        row.appendChild(lbl);
        // Bar conteneur
        const bar = document.createElement('div');
        bar.className = 'row-bar';
        // Bar remplissage
        const fill = document.createElement('div');
        fill.className = 'row-fill ' + (label.toLowerCase().includes('gÃ©othermie') ? 'row-fill-geothermie' : 'row-fill-default');
        const width = maxVal > 0 ? (values[idx] / maxVal) * 100 : 0;
        fill.style.width = width + '%';
        bar.appendChild(fill);
        row.appendChild(bar);
        wrapper.appendChild(row);
      });
      container.appendChild(wrapper);
    }

    /**
     * CrÃ©e un graphique en colonnes verticales afin de visualiser les consommations avec des couleurs distinctes par Ã©nergie.
     * @param {string} containerId ID du conteneur HTML oÃ¹ insÃ©rer le graphique
     * @param {string[]} labels Liste des Ã©tiquettes (Fioul, Gaz naturel, Propane, GÃ©othermie)
     * @param {number[]} values Valeurs associÃ©es Ã  chaque Ã©tiquette (en kWh)
     */
    function drawColumnChart(containerId, labels, values) {
      const container = document.getElementById(containerId);
      if (!container) return;
      // Vide le conteneur
      container.innerHTML = '';
      // Calcul du maximum pour normaliser la hauteur des barres
      const maxVal = Math.max(...values);
      // CrÃ©ation du conteneur vertical pour les colonnes
      const chart = document.createElement('div');
      chart.className = 'vertical-chart';
      labels.forEach((label, idx) => {
        const column = document.createElement('div');
        column.className = 'vertical-column';
        // Valeur numÃ©rique au-dessus de la barre
        const valueDiv = document.createElement('div');
        valueDiv.className = 'vertical-value';
        valueDiv.textContent = Math.round(values[idx]).toLocaleString() + 'Â â‚¬';
        // Barre colorÃ©e
        const bar = document.createElement('div');
        bar.className = 'vertical-bar';
        const height = maxVal > 0 ? (values[idx] / maxVal) * 100 : 0;
        bar.style.height = height + '%';
        // Couleur selon lâ€™Ã©nergie
        let color;
        const lower = label.toLowerCase();
        // Couleurs personnalisÃ©es pour le graphique en barres :
        // Fioul en orange (#fb8c00), Gaz naturel en violet (#8e24aa), Propane en rouge (#e53935), GÃ©othermie en vert foncÃ© (#00695c).
        if (lower.includes('fioul')) {
          color = '#fb8c00'; // orange pour le fioul
        } else if (lower.includes('gaz')) {
          color = '#8e24aa'; // violet pour le gaz naturel
        } else if (lower.includes('propane')) {
          color = '#e53935'; // rouge pour le propane
        } else if (lower.includes('gÃ©othermie') || lower.includes('geothermie')) {
          color = '#00695c'; // vert foncÃ© pour la gÃ©othermie
        } else {
          color = '#00897b';
        }
        bar.style.backgroundColor = color;
        // CrÃ©e un conteneur flexible pour forcer la barre Ã  sâ€™ancrer en bas
        const barWrapper = document.createElement('div');
        barWrapper.style.flexGrow = '1';
        barWrapper.style.display = 'flex';
        barWrapper.style.alignItems = 'flex-end';
        barWrapper.appendChild(bar);
        // Ã‰tiquette sous la barre
        const labelDiv = document.createElement('div');
        labelDiv.className = 'vertical-label';
        labelDiv.textContent = label;
        // Assemble les Ã©lÃ©ments dans la colonne
        column.appendChild(valueDiv);
        column.appendChild(barWrapper);
        column.appendChild(labelDiv);
        chart.appendChild(column);
      });
      container.appendChild(chart);
    }

    /**
     * CrÃ©e un graphique en colonnes verticales au format SVG.
     * Ce graphique est imprimable et conserve les couleurs lors de l'Ã©dition PDF.
     * @param {string} containerId ID du conteneur HTML oÃ¹ insÃ©rer le graphique
     * @param {string[]} labels Ã‰tiquettes (Fioul, Gaz naturel, Propane, GÃ©othermie)
     * @param {number[]} values Valeurs associÃ©es Ã  chaque Ã©tiquette (en euros)
     */
    function drawSVGColumnChart(containerId, labels, values) {
      const container = document.getElementById(containerId);
      if (!container) return;
      container.innerHTML = '';
      const maxVal = Math.max(...values);
      // Dimensions du graphique
      const svgWidth = container.clientWidth || 400;
      const svgHeight = 200;
      const paddingTop = 20;
      const paddingBottom = 40;
      const barAreaHeight = svgHeight - paddingTop - paddingBottom;
      const barWidth = svgWidth / labels.length * 0.5;
      const barGap = (svgWidth / labels.length - barWidth);
      // CrÃ©er l'Ã©lÃ©ment SVG
      const svgNS = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('width', '100%');
      svg.setAttribute('height', svgHeight);
      // Dessiner un cadre et une ligne de base pour amÃ©liorer la lisibilitÃ©
      const border = document.createElementNS(svgNS, 'rect');
      border.setAttribute('x', 0);
      border.setAttribute('y', 0);
      border.setAttribute('width', '100%');
      border.setAttribute('height', svgHeight);
      border.setAttribute('fill', 'none');
      border.setAttribute('stroke', '#cccccc');
      border.setAttribute('stroke-width', '1');
      svg.appendChild(border);
      // Ligne de base sous les barres
      const baseline = document.createElementNS(svgNS, 'line');
      baseline.setAttribute('x1', 0);
      baseline.setAttribute('y1', paddingTop + barAreaHeight);
      baseline.setAttribute('x2', svgWidth);
      baseline.setAttribute('y2', paddingTop + barAreaHeight);
      baseline.setAttribute('stroke', '#cccccc');
      baseline.setAttribute('stroke-width', '1');
      svg.appendChild(baseline);
      // Parcours des valeurs
      labels.forEach((label, idx) => {
        const x = barGap / 2 + idx * (barWidth + barGap);
        const barHeight = maxVal > 0 ? (values[idx] / maxVal) * barAreaHeight : 0;
        const y = paddingTop + (barAreaHeight - barHeight);
        // DÃ©terminer la couleur
        let color;
        const lower = label.toLowerCase();
        if (lower.includes('fioul')) {
          color = '#fb8c00';
        } else if (lower.includes('gaz')) {
          color = '#8e24aa';
        } else if (lower.includes('propane')) {
          color = '#e53935';
        } else if (lower.includes('gÃ©othermie') || lower.includes('geothermie')) {
          color = '#00695c';
        } else {
          color = '#00897b';
        }
        // Rectangle de barre
        const rect = document.createElementNS(svgNS, 'rect');
        rect.setAttribute('x', x);
        rect.setAttribute('y', y);
        rect.setAttribute('width', barWidth);
        rect.setAttribute('height', barHeight);
        rect.setAttribute('fill', color);
        svg.appendChild(rect);
        // Texte pour la valeur
        const valueText = document.createElementNS(svgNS, 'text');
        valueText.setAttribute('x', x + barWidth / 2);
        valueText.setAttribute('y', y - 5);
        valueText.setAttribute('text-anchor', 'middle');
        valueText.setAttribute('font-size', '10');
        valueText.textContent = Math.round(values[idx]).toLocaleString() + ' â‚¬';
        svg.appendChild(valueText);
        // Ã‰tiquette de l'Ã©nergie
        const labelText = document.createElementNS(svgNS, 'text');
        labelText.setAttribute('x', x + barWidth / 2);
        labelText.setAttribute('y', svgHeight - paddingBottom + 15);
        labelText.setAttribute('text-anchor', 'middle');
        labelText.setAttribute('font-size', '10');
        labelText.textContent = label;
        svg.appendChild(labelText);
      });
      container.appendChild(svg);
    }

    /**
     * CrÃ©e un graphique Ã  barres horizontales avec des valeurs numÃ©riques pour la consommation.
     * Chaque Ã©nergie est reprÃ©sentÃ©e par une couleur spÃ©cifique. Les valeurs sont affichÃ©es Ã  droite des barres.
     * @param {string} containerId ID du conteneur HTML oÃ¹ insÃ©rer le graphique
     * @param {string[]} labels Liste des Ã©tiquettes dâ€™Ã©nergie
     * @param {number[]} values Valeurs (kWh) associÃ©es Ã  chaque Ã©nergie
     */
    function drawConsumptionBars(containerId, labels, values) {
      const container = document.getElementById(containerId);
      if (!container) return;
      container.innerHTML = '';
      const maxVal = Math.max(...values);
      // Couleurs mappÃ©es par Ã©tiquette
      const colors = {
        fioul: '#e53935',
        'gaz naturel': '#8e24aa',
        propane: '#fb8c00',
        gÃ©othermie: '#00695c',
        geothermie: '#00695c'
      };
      const wrapper = document.createElement('div');
      wrapper.className = 'chart-bars-horizontal';
      labels.forEach((label, idx) => {
        const row = document.createElement('div');
        row.className = 'chart-row';
        // Ã‰tiquette (colonne fixe)
        const lbl = document.createElement('div');
        lbl.className = 'row-label';
        lbl.textContent = label;
        row.appendChild(lbl);
        // Conteneur de la barre (prend toute la largeur disponible)
        const barContainer = document.createElement('div');
        barContainer.className = 'row-bar';
        barContainer.style.flexGrow = '1';
        // Remplissage colorÃ©
        const fill = document.createElement('div');
        fill.className = 'row-fill';
        const width = maxVal > 0 ? (values[idx] / maxVal) * 100 : 0;
        fill.style.width = width + '%';
        const key = label.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        fill.style.backgroundColor = colors[key] || '#00897b';
        barContainer.appendChild(fill);
        row.appendChild(barContainer);
        // Valeur numÃ©rique Ã  droite
        const val = document.createElement('div');
        val.className = 'row-value';
        val.textContent = values[idx].toLocaleString(undefined, { maximumFractionDigits: 0 }) + ' kWh';
        row.appendChild(val);
        wrapper.appendChild(row);
      });
      container.appendChild(wrapper);
    }

    // Initialisation
    document.addEventListener('DOMContentLoaded', () => {
      initModeleOptions();
      updateEnergyFields();
      updateProgress();
    });
  </script>
</body>
</html>
